train_file:/home/syp/zwr/txtgen/examples/long_text/yelp_data/pos/pos.train.txt
valid_file:/home/syp/zwr/txtgen/examples/long_text/yelp_data/pos/pos.valid.txt
logdir:./log_dir/pos.bsize400.epoch150.seqlen16.dynamic_lr.fixed_mask.present0.7.partition2.hidden512/
epoch:70 test_present_rate:0.7 test_bleu:65.70523381233215 template_bleu:42.23254323005676 test_loss:2.9785003662109375 test_ppl:21.028303146362305 
step:18401 source:(400, 17) loss:2.489362 ppl:12.053580 lr:0.000098
step:18601 source:(400, 17) loss:2.495191 ppl:12.124053 lr:0.000097
step:18801 source:(400, 17) loss:2.441997 ppl:11.495971 lr:0.000097
step:19001 source:(400, 17) loss:2.436237 ppl:11.429950 lr:0.000096
step:19201 source:(400, 17) loss:2.375521 ppl:10.756613 lr:0.000096
step:19401 source:(400, 17) loss:2.393157 ppl:10.947997 lr:0.000095
epoch:75 test_present_rate:0.7 test_bleu:65.13721942901611 template_bleu:42.23254323005676 test_loss:3.0584521293640137 test_ppl:23.04166030883789 
step:19601 source:(400, 17) loss:2.444397 ppl:11.523604 lr:0.000095
step:19801 source:(400, 17) loss:2.392871 ppl:10.944871 lr:0.000094
step:20001 source:(400, 17) loss:2.399194 ppl:11.014293 lr:0.000094
step:20201 source:(400, 17) loss:2.423781 ppl:11.288460 lr:0.000093
step:20401 source:(400, 17) loss:2.466402 ppl:11.779989 lr:0.000093
step:20601 source:(400, 17) loss:2.477951 ppl:11.916825 lr:0.000092
step:20801 source:(400, 17) loss:2.418604 ppl:11.230170 lr:0.000092
epoch:80 test_present_rate:0.7 test_bleu:65.91449975967407 template_bleu:42.23254323005676 test_loss:3.01364803314209 test_ppl:21.777631759643555 
step:21001 source:(400, 17) loss:2.390376 ppl:10.917599 lr:0.000091
step:21201 source:(400, 17) loss:2.364273 ppl:10.636299 lr:0.000091
step:21401 source:(400, 17) loss:2.349774 ppl:10.483202 lr:0.000091
step:21601 source:(400, 17) loss:2.412266 ppl:11.159220 lr:0.000090
step:21801 source:(400, 17) loss:2.378628 ppl:10.790087 lr:0.000090
step:22001 source:(400, 17) loss:2.398109 ppl:11.002354 lr:0.000089
epoch:85 test_present_rate:0.7 test_bleu:62.50815391540527 template_bleu:42.23254323005676 test_loss:3.055497646331787 test_ppl:22.77678680419922 
step:22201 source:(400, 17) loss:2.356718 ppl:10.556252 lr:0.000089
step:22401 source:(400, 17) loss:2.362824 ppl:10.620899 lr:0.000089
step:22601 source:(400, 17) loss:2.393598 ppl:10.952829 lr:0.000088
step:22801 source:(400, 17) loss:2.349509 ppl:10.480420 lr:0.000088
step:23001 source:(400, 17) loss:2.289860 ppl:9.873560 lr:0.000087
step:23201 source:(400, 17) loss:2.377020 ppl:10.772756 lr:0.000087
step:23401 source:(400, 17) loss:2.376614 ppl:10.768383 lr:0.000087
epoch:90 test_present_rate:0.7 test_bleu:58.47929120063782 template_bleu:42.23254323005676 test_loss:3.0793426036834717 test_ppl:23.45099449157715 
step:23601 source:(400, 17) loss:2.382965 ppl:10.836987 lr:0.000086
step:23801 source:(400, 17) loss:2.304692 ppl:10.021090 lr:0.000086
step:24001 source:(400, 17) loss:2.404425 ppl:11.072061 lr:0.000086
step:24201 source:(400, 17) loss:2.316449 ppl:10.139606 lr:0.000085
step:24401 source:(400, 17) loss:2.320612 ppl:10.181906 lr:0.000085
step:24601 source:(400, 17) loss:2.294091 ppl:9.915421 lr:0.000085
/home/syp/miniconda2/envs/newtf/lib/python3.6/importlib/_bootstrap.py:205: RuntimeWarning: compiletime version 3.5 of module 'tensorflow.python.framework.fast_tensor_util' does not match runtime version 3.6
  return f(*args, **kwds)
Traceback (most recent call last):
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1323, in _do_call
    return fn(*args)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1302, in _run_fn
    status, run_metadata)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/framework/errors_impl.py", line 473, in __exit__
    c_api.TF_GetCode(self.status.status))
tensorflow.python.framework.errors_impl.UnknownError: IndexError: too many indices for array
	 [[Node: PyFunc_20 = PyFunc[Tin=[DT_INT64, DT_INT64], Tout=[DT_INT64, DT_INT64], token="pyfunc_20", _device="/job:localhost/replica:0/task:0/device:CPU:0"](PyFunc_19, Variable_20/read)]]
	 [[Node: decoder_4/while/layer_0/self_attention/multihead_attention/q/Tensordot/Gather/_2551 = _HostRecv[client_terminated=false, recv_device="/job:localhost/replica:0/task:0/device:GPU:0", send_device="/job:localhost/replica:0/task:0/device:CPU:0", send_device_incarnation=1, tensor_name="edge_11842_decoder_4/while/layer_0/self_attention/multihead_attention/q/Tensordot/Gather", tensor_type=DT_INT32, _device="/job:localhost/replica:0/task:0/device:GPU:0"](^_cloopdecoder_4/while/layer_5/self_attention/multihead_attention/dropout/cond/pred_id/_884)]]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "long_text_gen.py", line 365, in <module>
    tf.app.run(main=_main)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/platform/app.py", line 48, in run
    _sys.exit(main(_sys.argv[:1] + flags_passthrough))
  File "long_text_gen.py", line 337, in _main
    bleu_scores, test_ppl = _test_epoch(sess, epoch)
  File "long_text_gen.py", line 215, in _test_epoch
    rtns = cur_sess.run(fetches, feed_dict=feed)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 889, in run
    run_metadata_ptr)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1120, in _run
    feed_dict_tensor, options, run_metadata)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1317, in _do_run
    options, run_metadata)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1336, in _do_call
    raise type(e)(node_def, op, message)
tensorflow.python.framework.errors_impl.UnknownError: IndexError: too many indices for array
	 [[Node: PyFunc_20 = PyFunc[Tin=[DT_INT64, DT_INT64], Tout=[DT_INT64, DT_INT64], token="pyfunc_20", _device="/job:localhost/replica:0/task:0/device:CPU:0"](PyFunc_19, Variable_20/read)]]
	 [[Node: decoder_4/while/layer_0/self_attention/multihead_attention/q/Tensordot/Gather/_2551 = _HostRecv[client_terminated=false, recv_device="/job:localhost/replica:0/task:0/device:GPU:0", send_device="/job:localhost/replica:0/task:0/device:CPU:0", send_device_incarnation=1, tensor_name="edge_11842_decoder_4/while/layer_0/self_attention/multihead_attention/q/Tensordot/Gather", tensor_type=DT_INT32, _device="/job:localhost/replica:0/task:0/device:GPU:0"](^_cloopdecoder_4/while/layer_5/self_attention/multihead_attention/dropout/cond/pred_id/_884)]]

Caused by op 'PyFunc_20', defined at:
  File "long_text_gen.py", line 365, in <module>
    tf.app.run(main=_main)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/platform/app.py", line 48, in run
    _sys.exit(main(_sys.argv[:1] + flags_passthrough))
  File "long_text_gen.py", line 138, in _main
    mask_id, eoa_id, pad_id)
  File "/home/syp/zwr/txtgen/texar/utils/transformer_utils.py", line 753, in update_template_pack
    start_positions, end_positions = _get_start_end_pos(masked_inputs, mask_id)
  File "/home/syp/zwr/txtgen/texar/utils/transformer_utils.py", line 571, in _get_start_end_pos
    [tf.int64, tf.int64])
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/ops/script_ops.py", line 212, in py_func
    input=inp, token=token, Tout=Tout, name=name)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/ops/gen_script_ops.py", line 50, in _py_func
    "PyFunc", input=input, token=token, Tout=Tout, name=name)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py", line 787, in _apply_op_helper
    op_def=op_def)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py", line 2956, in create_op
    op_def=op_def)
  File "/home/syp/miniconda2/envs/newtf/lib/python3.6/site-packages/tensorflow/python/framework/ops.py", line 1470, in __init__
    self._traceback = self._graph._extract_stack()  # pylint: disable=protected-access

UnknownError (see above for traceback): IndexError: too many indices for array
	 [[Node: PyFunc_20 = PyFunc[Tin=[DT_INT64, DT_INT64], Tout=[DT_INT64, DT_INT64], token="pyfunc_20", _device="/job:localhost/replica:0/task:0/device:CPU:0"](PyFunc_19, Variable_20/read)]]
	 [[Node: decoder_4/while/layer_0/self_attention/multihead_attention/q/Tensordot/Gather/_2551 = _HostRecv[client_terminated=false, recv_device="/job:localhost/replica:0/task:0/device:GPU:0", send_device="/job:localhost/replica:0/task:0/device:CPU:0", send_device_incarnation=1, tensor_name="edge_11842_decoder_4/while/layer_0/self_attention/multihead_attention/q/Tensordot/Gather", tensor_type=DT_INT32, _device="/job:localhost/replica:0/task:0/device:GPU:0"](^_cloopdecoder_4/while/layer_5/self_attention/multihead_attention/dropout/cond/pred_id/_884)]]

